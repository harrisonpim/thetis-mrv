version: "3.8"

services:
  jupyter:
    build: 
      dockerfile: jupyter/Dockerfile
      context: .
    ports:
      - 8888:8888
    volumes:
      - type: bind
        source: ./jupyter/notebooks
        target: /home/jovyan/
      - type: bind
        source: ./data
        target: /home/jovyan/data
      - type: bind
        source: ./src
        target: /home/jovyan/src
    env_file:
      - .env
      - ./jupyter/.env
    environment:
      - JUPYTER_ENABLE_LAB=yes
    depends_on:
      - postgres

  format-python:
    image: python:3.8-slim
    volumes: 
      - type: bind
        source: ./
        target: /repo
    working_dir: /repo
    command: sh tasks/format.sh

  get-data:
    build:
      dockerfile: tasks/get_data/Dockerfile
      context: .
    volumes:
      - type: bind
        source: ./data
        target: /data
      - type: bind
        source: ./tasks
        target: /tasks
    command: python /tasks/get_data/main.py

  postgres:
    image: postgres
    env_file: .env
    ports:
      - 5432:5432
    volumes:
      - type: bind
        source: ./data/postgres
        target: /var/lib/postgresql/data/
